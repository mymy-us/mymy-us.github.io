{{> head}}
{{> top}}

<main id="main">
   {{#post}}
      <article class="post">
            <header class="major" style="margin-bottom: 2rem;">
               <h1 style="margin-bottom: 0.5rem;">
                  {{title}}
               </h1>

               <!-- START NEW META LINE (Author | Date | Reading Time) -->
               <div style="display: flex; justify-content: center; align-items: center; gap: 15px; font-size: 0.85rem; color: #777; font-family: 'Oswald', sans-serif; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 2rem;">
                  
                  <!-- Author Link (Grey and links to saying-hola.html) -->
                  {{#author}}
                  <span>By <span style="color: #777; border-bottom: none; font-weight: 600;">{{name}}</span></span>
                  {{/author}}

                  <span style="opacity: 0.3;">|</span>
                  
                  <!-- Date (With "Posted on") -->
                  {{#if @config.post.displayDate}}
                     <time datetime="{{date createdAt 'YYYY-MM-DDTHH:mm'}}">
                        Posted on 
                        {{#checkIf @config.custom.formatDate '!=' 'custom'}}
                           {{date createdAt @config.custom.formatDate}}
                        {{else}}
                           {{date createdAt @config.custom.formatDateCustom}}
                        {{/checkIf}}
                     </time>
                  {{/if}}

                  <span style="opacity: 0.3;">|</span>

                  <!-- Reading Time Plugin Anchor -->
                  <span class="time-anchor">&nbsp;</span>

               </div>
               <!-- END NEW META LINE -->

               <p class="post__inner">{{@config.post.introText}}</p>
            </header>

            {{#featuredImage}}
               {{#if url}}
                  <figure class="image main">
                     <img
                        src="{{url}}"
                        {{#if @config.site.responsiveImages}}
                           {{responsiveImageAttributes 'featuredImage' srcset.post sizes.post}}
                        {{/if}}
                        {{ lazyload "lazy" }}
                        height="{{height}}"
                        width="{{width}}"
                        alt="{{alt}}">
                     {{#checkIfAny caption credits}}
                        <figcaption>
                           {{caption}}
                           {{credits}}
                        </figcaption>                      
                     {{/checkIfAny}} 
                  </figure>
               {{/if}}
            {{/featuredImage}}

         <!-- START Engineering Layout (TOC + Content) -->
         <div class="engineering-wrapper">
            <!-- Main Content -->
            <div class="post__inner post__entry engineering-content">           
               {{{text}}}            
            </div>

            <!-- Sidebar TOC -->
            <aside class="engineering-sidebar">
               <div class="toc-sticky">
                     <h4 class="toc-title">Contents</h4>
                     <ul id="auto-toc"></ul>
               </div>
            </aside>
         </div>

         <!-- Script to build the Table of Contents -->
         <script>
         document.addEventListener("DOMContentLoaded", function() {
            const tocList = document.getElementById("auto-toc");
            const headers = document.querySelectorAll(".engineering-content h2, .engineering-content h3");
            
            if (headers.length > 0) {
               document.querySelector(".engineering-sidebar").style.display = "block";
               
               headers.forEach(function(header, index) {
                     if (!header.id || /^\d/.test(header.id)) {
                        header.id = "section-" + index;
                     }
                     
                     const li = document.createElement("li");
                     li.className = header.tagName.toLowerCase();
                     
                     const link = document.createElement("a");
                     link.setAttribute("data-target", header.id);
                     link.href = "#" + header.id; 
                     link.textContent = header.textContent;
                     
                     link.addEventListener("click", function(e) {
                        e.preventDefault();
                        const targetId = this.getAttribute("data-target");
                        const targetElement = document.getElementById(targetId);
                        
                        if (targetElement) {
                           targetElement.scrollIntoView({
                                 behavior: "smooth"
                           });
                           history.pushState(null, null, '#' + targetId);
                        }
                     });

                     li.appendChild(link);
                     tocList.appendChild(li);
               });
            }
         });
         </script>
         <!-- END Engineering Layout -->

         <!-- Bottom Footer (Tags and Share Buttons ONLY) -->
         {{#checkIfAny @config.post.displayShareButtons @config.post.displayTags}}
            <footer class="post__inner post__footer">
               
               <div class="post__share-tag-container">
                  {{#if @config.post.displayTags}}
                     {{#if tags}}
                        <div class="post__tag">
                           <h3>Tags:</h3>
                              <ul>
                                 {{#each tags}}
                                    <li>
                                       <a href="{{url}}">{{name}}</a>
                                    </li>
                                 {{/each}}
                              </ul>
                        </div>
                     {{/if}}
                  {{/if}}
             
                  {{#if @config.post.displayShareButtons}}
                     <div class="post__share">
                        <button
                           class="post__share-button js-post__share-button icon"
                           aria-label="Share button">
                           <i class="fas fa-share-alt"></i>
                        </button>

                        <div class="post__share-popup js-post__share-popup">
                           {{#checkIfAll @plugins.socialSharing @plugins.socialSharing.state}}
                              {{{@customSocialSharing}}}
                           {{else}}   
                              {{> share-buttons}}
                           {{/checkIfAll}}  
                        </div>
                     </div>        
                  {{/if}}                  
               </div>
               
            </footer>
         {{/checkIfAny}}
      </article>

      {{#if @config.post.displayComments}}
         <div class="comments-area">
            <div class="post__inner">
               {{{@commentsCustomCode}}}
            </div>
         </div>
      {{/if}}

      {{#if @config.post.displayRelatedPosts}}
         {{#if ../relatedPosts}}
            <div>
               <strong>Related Posts:</strong>
            </div>
            <div class="posts">                 
                  {{#each ../relatedPosts}}
                     <article>
                        <header>
                           {{#if @config.custom.feedDate}}
                              <time datetime="{{date createdAt 'YYYY-MM-DDTHH:mm'}}" class="date">
                                 {{#checkIf @config.custom.formatDate '!=' 'custom'}}
                                    {{date createdAt @config.custom.formatDate}}
                                 {{else}}
                                    {{date createdAt @config.custom.formatDateCustom}}
                                 {{/checkIf}}
                              </time>
                           {{/if}}
                           <h2>
                              <a href="{{url}}">{{title}}</a>
                           </h2>
                        </header>

                        {{#if @config.custom.feedFeaturedImage}}
                           {{#featuredImage}}
                              {{#if url}}
                                 <a href="{{../url}}" class="image fit">
                                    <img
                                       src="{{url}}"
                                       {{#if @config.site.responsiveImages}}
                                          {{responsiveImageAttributes 'featuredImage' srcset.post sizes.post}}
                                       {{/if}}
                                       {{ lazyload "lazy" }}
                                       height="{{height}}"
                                       width="{{width}}"
                                       alt="{{alt}}">
                                 </a>
                              {{/if}}
                           {{/featuredImage}}
                        {{/if}}

                        <p>{{{ excerpt }}}</p>

                        {{#if @config.custom.feedReadMore}}
                           <ul class="actions special">
                              <li>
                                 <a href="{{url}}" class="button">Read Full Article</a>
                              </li>
                           </ul>
                        {{/if}}

                     </article>
                  {{/each}}
               </div>
           
         {{/if}}
      {{/if}}

      {{#if @customHTML.afterPost}}
         <div class="banner banner--after-post">
            <div class="wrapper">
               {{{@customHTML.afterPost}}}
            </div>
         </div>
      {{/if}}

   {{/post}}
</main>
{{> footer}}